<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" href="/cmq.png">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Archive — Chica Mob Quarterly</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Londrina+Shadow&family=Love+Ya+Like+A+Sister&display=swap" rel="stylesheet">

  <!-- Base styles -->
  <!-- <link rel="stylesheet" href="../styles.css"> -->

  <script src="../comics.data.js" defer></script>

  <style>
    .archive-container { margin: 2rem 0; }
    .archive-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 16px;
      padding: 1rem;
      background: #fff;
    }
    .archive-card {
      display: block;
      border: 1px solid #e6e6e6;
      border-radius: 8px;
      background: #fff;
      color: inherit;
      text-decoration: none;
      overflow: hidden;
      transition: transform .08s ease, box-shadow .08s ease;
    }
    .archive-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 14px rgba(0,0,0,.06);
    }
    .archive-thumb { background: #fff; padding: 8px; border-bottom: 1px solid #f0f0f0; }
    .archive-thumb img {
      width: 100%;
      height: 280px;
      object-fit: contain;
      background: #fff;
      border: 1px solid #eee;
      border-radius: 4px;
    }
    .archive-meta { padding: 10px 12px 12px; }
    .archive-meta h3 {
      font-family: 'Londrina Shadow', cursive;
      font-size: 1.25rem;
      font-weight: 400;
      color: #111;
      margin-bottom: .15rem;
    }
    .archive-meta p {
      font-family: 'Love Ya Like A Sister', cursive;
      font-size: .95rem;
      color: #666;
    }
    @media (max-width: 480px) {
      .archive-thumb img { height: 220px; }
    }
  </style>
</head>
<body>

  <main>
    <div id="archive-grid" class="archive-grid" aria-live="polite"></div>
  </main>

  <footer>
    © <span id="year"></span> Chica Mob Quarterly
  </footer>

  <script src="script.js"></script>
  <script>
  // Simple fallback formatter so the archive doesn't depend on script.js
  function formatDate(dateStr) {
    try {
      const [y, m, d] = dateStr.split('-').map(Number);
      const dt = new Date(y, m - 1, d);
      if (isNaN(dt)) return dateStr || 'Unknown Date';
      return dt.toLocaleDateString('en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
    } catch { return dateStr || 'Unknown Date'; }
  }

  document.getElementById('year').textContent = new Date().getFullYear();
  const READER_ROOT = '/'; // your reader homepage; hash links work there

  function buildArchive() {
    const grid = document.getElementById('archive-grid');
    const data = (window && window.CHICA_COMICS) ? window.CHICA_COMICS : null;
    if (!grid || !data) return;

    // Newest first (reverse if you want oldest first)
    const pages = Object.keys(data).map(Number).sort((a, b) => a - b);

    const frag = document.createDocumentFragment();
    pages.forEach(num => {
      const c = data[num] || {};
      const title = c.title || `Page ${num}`;
      const pretty = c.date ? formatDate(c.date) : 'Unknown Date';

      const a = document.createElement('a');
      a.className = 'archive-card';
      a.href = READER_ROOT + '#' + num;         // deep-link to the main reader
      a.setAttribute('aria-label', `${title} — ${pretty}`);

      const thumb = document.createElement('div');
      thumb.className = 'archive-thumb';

      const img = document.createElement('img');
      img.loading = 'lazy';
      img.alt = title;
      img.src = c.image || '';
      img.onerror = function () {
        // light inline placeholder so we don't depend on script.js
        this.src = 'data:image/svg+xml;base64,' + btoa(`
          <svg xmlns="http://www.w3.org/2000/svg" width="800" height="1000">
            <rect width="100%" height="100%" fill="#ffffff"/>
            <rect x="20" y="20" width="760" height="960" fill="none" stroke="#eee" stroke-width="2"/>
            <text x="50%" y="45%" text-anchor="middle" font-family="sans-serif" font-size="18" fill="#999">Image not available</text>
            <text x="50%" y="55%" text-anchor="middle" font-family="sans-serif" font-size="16" fill="#bbb">${title.replace(/&/g,'&amp;')}</text>
          </svg>
        `);
      };
      thumb.appendChild(img);

      const meta = document.createElement('div');
      meta.className = 'archive-meta';
      const h3 = document.createElement('h3');
      h3.textContent = title;
      const p = document.createElement('p');
      p.textContent = pretty;
      meta.appendChild(h3);
      meta.appendChild(p);

      a.appendChild(thumb);
      a.appendChild(meta);
      frag.appendChild(a);
    });

    grid.textContent = ''; // clear if re-rendering
    grid.appendChild(frag);
  }

  document.addEventListener('DOMContentLoaded', buildArchive);
</script>

</body>
</html>

